default-lease-time 7200;
max-lease-time 7200;
allow unknown-clients;
option subnet-mask 255.255.255.0;

### PXE ###
option space PXE;
option PXE.mtftp-ip code 1 = ip-address;
option PXE.mtftp-cport code 2 = unsigned integer 16;
option PXE.mtftp-sport code 3 = unsigned integer 16;
option PXE.mtftp-tmout code 4 = unsigned integer 8;
option PXE.mtftp-delay code 5 = unsigned integer 8;
option arch code 93 = unsigned integer 16;
option space ipxe;
option ipxe-encap-opts code 175 = encapsulate ipxe;
option ipxe.priority code 1 = signed integer 8;
option ipxe.keep-san code 8 = unsigned integer 8;
option ipxe.skip-san-boot code 9 = unsigned integer 8;
option ipxe.syslogs code 85 = string;
option ipxe.cert code 91 = string;
option ipxe.privkey code 92 = string;
option ipxe.crosscert code 93 = string;
option ipxe.no-pxedhcp code 176 = unsigned integer 8;
option ipxe.bus-id code 177 = string;
option ipxe.san-filename code 188 = string;
option ipxe.bios-drive code 189 = unsigned integer 8;
option ipxe.username code 190 = string;
option ipxe.password code 191 = string;
option ipxe.reverse-username code 192 = string;
option ipxe.reverse-password code 193 = string;
option ipxe.version code 235 = string;
option iscsi-initiator-iqn code 203 = string;

# Feature indicators
option ipxe.pxeext code 16 = unsigned integer 8;
option ipxe.iscsi code 17 = unsigned integer 8;
option ipxe.aoe code 18 = unsigned integer 8;
option ipxe.http code 19 = unsigned integer 8;
option ipxe.https code 20 = unsigned integer 8;
option ipxe.tftp code 21 = unsigned integer 8;
option ipxe.ftp code 22 = unsigned integer 8;
option ipxe.dns code 23 = unsigned integer 8;
option ipxe.bzimage code 24 = unsigned integer 8;
option ipxe.multiboot code 25 = unsigned integer 8;
option ipxe.slam code 26 = unsigned integer 8;
option ipxe.srp code 27 = unsigned integer 8;
option ipxe.nbi code 32 = unsigned integer 8;
option ipxe.pxe code 33 = unsigned integer 8;
option ipxe.elf code 34 = unsigned integer 8;
option ipxe.comboot code 35 = unsigned integer 8;
option ipxe.efi code 36 = unsigned integer 8;
option ipxe.fcoe code 37 = unsigned integer 8;
option ipxe.vlan code 38 = unsigned integer 8;
option ipxe.menu code 39 = unsigned integer 8;
option ipxe.sdi code 40 = unsigned integer 8;
option ipxe.nfs code 41 = unsigned integer 8;

### RESEAUX ###
subnet 10.10.62.0 netmask 255.255.255.0 {
    option broadcast-address 10.10.62.255;
    option routers 10.10.62.254;
    option domain-name-servers 172.16.1.254;
    range 10.10.62.160 10.10.62.209;
    ping-check = 1;
    next-server 10.10.62.210;

    # Réservations d'adresses IP permanentes

###################################################
host machine_25 {
    hardware ethernet 04:d9:c8:6b:80:fc;
    fixed-address 12.32.43.0;
} else {
            filename "ipxe/ipxe.efi";
        }
    }
    else if option arch = 00:06 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "ipxe/ipxe32.efi";
        }
    }
    else {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "undionly.kpxe";
        }
    }
}

host machine_54 {
    hardware ethernet 04:d9:c8:6c:55:dd;;
    fixed-address 10.10.62.115;
    # PXE Boot
    if option arch = 00:07 or option arch = 00:09 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "ipxe/ipxe.efi";
        }
    }
    else if option arch = 00:06 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "ipxe/ipxe32.efi";
        }
    }
    else {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "undionly.kpxe";
        }
    }
}

host machine_74 {
    hardware ethernet bc:24:11:fd:cb:47;;
    fixed-address 10.10.62.68;
    # PXE Boot
    if option arch = 00:07 or option arch = 00:09 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "ipxe/ipxe.efi";
        }
    }
    else if option arch = 00:06 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "ipxe/ipxe32.efi";
        }
    }
    else {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/menu_known2.ipxe";
        } else {
            filename "undionly.kpxe";
        }
    }
}

#                LES RESERVATIONS               #
##################################################
    

    


    host machine1 {
        hardware ethernet 06:d9:c8:6c:55:dd;
        fixed-address 12.31.43.0;
        # PXE Boot
        if option arch = 00:07 or option arch = 00:09 {
            # Condition pour éviter la réinstallation
            if exists user-class and option user-class = "iPXE" {
                filename "http://10.10.62.210/menu_known2.ipxe";

            } else {
                filename "ipxe/ipxe.efi";
            }
        } 
        else if option arch = 00:06 {
            if exists user-class and option user-class = "iPXE" {
                filename "http://10.10.62.210/menu_known2.ipxe";
            } else {
                filename "ipxe/ipxe32.efi";
            }
        } 
        else {
            if exists user-class and option user-class = "iPXE" {
                filename "http://10.10.62.210/menu_known2.ipxe";
            } else {
                filename "undionly.kpxe";
            }
        }
    
}


    # PXE Boot
    if option arch = 00:07 or option arch = 00:09 {
        # Condition pour éviter la réinstallation
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/install.ipxe";

        } else {
            filename "ipxe/ipxe.efi";
        }
    } 
    else if option arch = 00:06 {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/install.ipxe";
        } else {
            filename "ipxe/ipxe32.efi";
        }
    } 
    else {
        if exists user-class and option user-class = "iPXE" {
            filename "http://10.10.62.210/install.ipxe";
        } else {
            filename "undionly.kpxe";
        }
    }

    
}